#
# Usage: ansible-playbook build_world.yml -i hosts -u citrusleaf -e "hosts=bunny clientTag=master"
#

- name: Build client
  hosts: $hosts
  sudo: False
  gather_facts: False
  vars:
    clientTag: "prod3.0"

  tasks:
    - name: Client checkout $clientTag
      git: repo=git@github.com:citrusleaf/aerospike-client-c.git dest=~/aerospike-client-c version=$clientTag

    - name: Client reset modules
      command: modules reset chdir=~/aerospike-client-c

    - name: Client build and package
      shell: build/build_package chdir=~/aerospike-client-c

  tags:
    - buildclient

- name: Release client
  hosts: $hosts
  sudo: True
  gather_facts: False

  tasks:
    - name: Client release
      shell: build/release_fileserver chdir=/home/citrusleaf/aerospike-client-c

  tags:
    - releaseclient

