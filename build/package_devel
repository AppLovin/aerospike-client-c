#!/bin/sh
# Package development (headers and libraries).

cd `dirname $0`

target=${1-.}
platform=`./parse_platform`
rev=`./version`

if [ $platform = "el5" ] || [ $platform = "el6" ]
then 
  rpm=true
else
  rpm=false
fi

# Create development package.
packageName=aerospike-client-c-devel-$rev.$platform.x86_64
dist=/tmp/$packageName
build=$dist/BUILD

rm -rf $dist
mkdir -p $build/usr/lib
cp ../aerospike/target/Linux-x86_64/lib/* $build/usr/lib
mkdir -p $build/usr/include
cp -r ../aerospike/target/Linux-x86_64/include $build/usr
chmod 644 $build/usr/include/{citrusleaf,aerospike}/*
mkdir -p $build/opt/aerospike/client/sys/udf/lua
mkdir -p $build/opt/aerospike/client/usr/udf/lua
cp ../aerospike-mod-lua/src/lua/{aerospike.lua,as.lua,stream_ops.lua} $build/opt/aerospike/client/sys/udf/lua
exit
if $rpm
then
  spec=/tmp/client_v.spec
  rpmrev=`echo $rev | sed 's/-/_/g'`
  sed 's/@VERSION@/'$rpmrev'/g' < rpm/client_devel.spec > $spec
  rpmbuild -bb --buildroot $build $spec
  rm $spec
  pkg=~/rpmbuild/RPMS/x86_64/aerospike-client-c-devel-$rpmrev*.rpm
else
  mkdir -p $build/DEBIAN
  install -m 755 deb/postinst.client $build/DEBIAN/postinst
  sed 's/@VERSION@/'$rev'/g' < deb/client_devel.spec > $build/DEBIAN/control
  pkg=deb/$packageName.deb
  fakeroot dpkg-deb --build $build $pkg
fi

mv $pkg $target
rm -rf $dist

