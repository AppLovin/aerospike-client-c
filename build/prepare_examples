#!/bin/sh
# Build examples source code package.

cd `dirname $0`
target=${1-.}

# Create examples.
srcExamplesDir=../aerospike/examples
trgExamplesDir=$target/examples

mkdir -p $trgExamplesDir
cp $srcExamplesDir/Makefile $trgExamplesDir
cp $srcExamplesDir/README.md $trgExamplesDir
cp -r $srcExamplesDir/utils $trgExamplesDir
cp -r $srcExamplesDir/basic_examples $trgExamplesDir

for i in $srcExamplesDir/basic_examples/*/Makefile
do
	dir=`dirname $i`
	example=`basename $dir`
	rm -rf $trgExamplesDir/basic_examples/$example/target

	# Modify Makefile for external use.
	awk 'BEGIN{OFS=""}
	{
		if (index($0,"AEROSPIKE") > 0)
		{
			idx = index($0,"$(AEROSPIKE)/target/Linux-x86_64/lib/libaerospike.a")

			if (idx > 0)
			{
				# Use extra space in lib to compensate for incompatibility
				# between centos gawk and debian mawk.
				print substr($0, 0, idx-1)," /usr/lib/libaerospike.a"
			}
		}
		else
		{
			print $0
		}
	}' $i > $trgExamplesDir/basic_examples/$example/Makefile
done

